---
- name: Change IP Address for Windows Machine
  vmware_vm_shell:
    validate_certs: "{{ vmware_validate_certs }}"
    hostname: "{{ vmware_vcenter_host }}"
    username: "{{ vmware_vcenter_username }}"
    password: "{{ vmware_vcenter_password }}"
    datacenter: "{{ vmware_vcenter_datacenter }}"
    folder: "{{ vm.vmware_vm_folder }}"
    vm_id: "{{ vm.vmware_vm_name }}"
    vm_username: "{{ vm.vmware_vm_username }}"
    vm_password: "{{ vm.vmware_vm_password }}"
    vm_shell: netsh.exe
    vm_shell_args: ' interface ip set address name="{{ vm.vmware_vm_conn_name  }}" {{ vm.vmware_vm_conn_type }} {{ vm.vmware_vm_conn_ipv4_address }} {{ vm.vmware_vm_conn_gateway }}'
    vm_shell_cwd: "{{ vm.vmware_vm_shell_cwd }}"

- name: Change DNS for Windows Machine
  vmware_vm_shell:
    validate_certs: "{{ vmware_validate_certs }}"
    hostname: "{{ vmware_vcenter_host }}"
    username: "{{ vmware_vcenter_username }}"
    password: "{{ vmware_vcenter_password }}"
    datacenter: "{{ vmware_vcenter_datacenter }}"
    folder: "{{ vm.vmware_vm_folder }}"
    vm_id: "{{ vm.vmware_vm_name }}"
    vm_username: "{{ vm.vmware_vm_username }}"
    vm_password: "{{ vm.vmware_vm_password }}"
    vm_shell       : netsh.exe
    vm_shell_args  : ' interface ip set dns name="{{ vm.vmware_vm_conn_name  }}" {{ vm.vmware_vm_conn_type }} {{ vm.vmware_vm_conn_dns1 }}'
    vm_shell_cwd: "{{ vm.vmware_vm_shell_cwd }}"

- name: Wait until the ipaddress of machine is ready
  wait_for:
    port: 5986
    delay: 20
    state: started
    host: "{{ vm.vmware_vm_conn_ipv4_address }}"

